<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Human Gut Microbial Biobank</title>
  <!-- 引入外部资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>

  <!-- 手动指定favicon，解决404问题 -->
  <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0iIzE2NUZG RiIgZD0iTTEyIDJDMTEuNCAyIDExIDQuMjQgMTEgNy41QzExIDExLjQ4IDExLjcgMTUuMjQgMTIgMTkgMTIuMyAxNS4yNCAxMyA xMS40OCAxMyA3LjVDMTMgNC4yNCAxMi42IDIgMTIgMnptMCAyMGMtMS4xIDAtMi0uOS0yLTJWNmMyIDAgMiA0IDIgMTJzMCAxMi0yIDEyek02IDE1aDJ2LTRINnY0em02IDBoMnYtNEg xMnY0em02IDBoMnYtNEg xOFYxNXoiLz48L3N2Zz4=" />

  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36BFFA',
            accent: '#0FC6C2',
            neutral: '#F5F7FA',
            dark: '#1D2129',
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>

  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .card-hover {
        @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
      }
    }
  </style>

  <style>
    /* 基础动画定义 */
    .fade-in {
      animation: fadeIn 0.8s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* 平滑滚动 */
    html {
      scroll-behavior: smooth;
    }

    /* 导航栏滚动效果 */
    .nav-scrolled {
      @apply bg-white shadow-md;
    }
  </style>
</head>

<body class="font-sans text-dark bg-gray-50">
  <!-- 导航栏 -->
  <header id="navbar" class="fixed w-full top-0 z-50 transition-all duration-300 bg-white/90 backdrop-blur-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-4">
        <!-- Logo -->
        <a href="#" class="flex items-center space-x-2">
          <div class="w-10 h-10 rounded-lg bg-primary flex items-center justify-center">
            <i class="fa fa-flask text-white text-xl"></i>
          </div>
          <span class="text-xl font-bold text-primary">hGMB Database</span>
        </a>

        <!-- 桌面导航 -->
        <nav class="hidden md:flex items-center space-x-8">
          <a href="#home" class="text-gray-700 hover:text-primary transition-colors">Home</a>
          <a href="#about" class="text-gray-700 hover:text-primary transition-colors">About</a>
          <a href="#scale" class="text-gray-700 hover:text-primary transition-colors">Database Scale</a>
          <a href="#features" class="text-gray-700 hover:text-primary transition-colors">Features</a>
          <a href="#query" class="text-gray-700 hover:text-primary transition-colors">Search</a>
        </nav>

        <!-- 登录/登出按钮 -->
        <div class="flex items-center">
          <button id="loginBtn" class="bg-primary hover:bg-primary/90 text-white px-5 py-2 rounded-lg transition-all duration-300 flex items-center space-x-2 shadow-md hover:shadow-lg">
            <i class="fa fa-user-circle"></i>
            <span>Login</span>
          </button>
          <button id="logoutBtn" class="hidden ml-4 bg-gray-100 hover:bg-gray-200 text-gray-700 px-5 py-2 rounded-lg transition-all duration-300 flex items-center space-x-2 shadow-md hover:shadow-lg">
            <i class="fa fa-sign-out"></i>
            <span>Logout</span>
          </button>
        </div>

        <!-- 移动端菜单按钮 -->
        <button id="menuBtn" class="md:hidden text-gray-700 focus:outline-none">
          <i class="fa fa-bars text-2xl"></i>
        </button>
      </div>
    </div>

    <!-- 移动端导航菜单 -->
    <div id="mobileMenu" class="md:hidden hidden bg-white border-t">
      <div class="container mx-auto px-4 py-3 space-y-3">
        <a href="#home" class="block py-2 text-gray-700 hover:text-primary">Home</a>
        <a href="#about" class="block py-2 text-gray-700 hover:text-primary">About</a>
        <a href="#scale" class="block py-2 text-gray-700 hover:text-primary">Database Scale</a>
        <a href="#features" class="block py-2 text-gray-700 hover:text-primary">Features</a>
        <a href="#query" class="block py-2 text-gray-700 hover:text-primary">Search</a>
      </div>
    </div>
  </header>

  <!-- 主内容区 -->
  <main>
    <!-- 英雄区 -->
    <section id="home" class="pt-32 pb-20 bg-gradient-to-br from-primary/5 to-secondary/10">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col lg:flex-row items-center">
          <div class="lg:w-1/2 mb-10 lg:mb-0 fade-in">
            <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold leading-tight text-dark mb-6">
              Human Gut Microbial<br><span class="text-primary">Biobank Database</span>
            </h1>
            <p class="text-gray-600 text-lg mb-8 max-w-lg">
              A comprehensive resource for human gut microbial strains, providing detailed taxonomic, genomic and biological information for research community.
            </p>
            <div class="flex flex-wrap gap-4">
              <a href="#query" class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-lg transition-all duration-300 shadow-lg hover:shadow-xl flex items-center space-x-2">
                <i class="fa fa-search"></i>
                <span>Search Database</span>
              </a>
              <a href="#about" class="bg-white hover:bg-gray-50 text-primary border border-primary px-6 py-3 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg flex items-center space-x-2">
                <i class="fa fa-info-circle"></i>
                <span>Learn More</span>
              </a>
            </div>
          </div>
          <div class="lg:w-1/2 fade-in" style="animation-delay: 0.3s">
            <div class="relative">
              <div class="absolute -inset-4 bg-gradient-to-r from-primary to-secondary rounded-2xl blur-lg opacity-20"></div>
                <div class="relative rounded-xl shadow-xl w-full max-w-lg mx-auto flex items-center justify-center" style="height: 400px; background-color: #f3f4f6;">
  <h1 class="text-4xl font-bold text-primary">欢迎访问我们的数据库！</h1>
</div>

              <div class="absolute -bottom-5 -left-5 bg-white p-4 rounded-lg shadow-lg">
                <div class="flex items-center space-x-3">
                  <div class="w-12 h-12 rounded-full bg-accent/20 flex items-center justify-center">
                    <i class="fa fa-database text-accent text-xl"></i>
                  </div>
                  <div>
                    <p class="text-sm text-gray-500">Total Strains</p>
                    <p class="text-xl font-bold text-dark">1,170+</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 数据库介绍 -->
    <section id="about" class="py-20 bg-white">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-4">About the Project</h2>
        </div>

        <div class="max-w-4xl mx-auto bg-neutral rounded-xl p-8 lg:p-10 shadow-md">
          <p class="text-gray-700 leading-relaxed mb-6">
            An open access human Gut Microbial Biobank (hGMB) were constructed by bacterial isolation and cultivation from feces of health volunteers. In total, 1,170 isolates representing 400 different species from 159 genera, 53 families and 6 phyla were included in hGMB and deposited in International Depository Authority (IDA)- the China General Microbiological Culture Collection Center (CGMCC) for long-term preservation and public use worldwide.
          </p>
          <p class="text-gray-700 leading-relaxed mb-6">
            The strain identities, genomic accessions and basic taxonomic information of known species were available in the webpage. Moreover, by genome sequencing and polyphasically characterization, 102 new species including 28 novel genera and 3 novel families were recognized by the hGMB work, and denominated following ICNP rules.
          </p>
          <p class="text-gray-700 leading-relaxed">
            Detailed genomic, taxonomic and biologic descriptions of the 102 new species were also provided in the webpage.
          </p>
        </div>

        <div class="mt-16 grid md:grid-cols-3 gap-8">
          <div class="bg-neutral rounded-xl p-6 card-hover">
            <div class="w-14 h-14 bg-primary/10 rounded-lg flex items-center justify-center mb-6">
              <i class="fa fa-flask text-primary text-2xl"></i>
            </div>
            <h3 class="text-xl font-bold mb-3">Authenticated Strains</h3>
            <p class="text-gray-600">All strains are carefully authenticated using polyphasic taxonomic approaches including phenotypic, chemotaxonomic and genomic analyses.</p>
          </div>

          <div class="bg-neutral rounded-xl p-6 card-hover">
            <div class="w-14 h-14 bg-secondary/10 rounded-lg flex items-center justify-center mb-6">
              <i class="fa fa-dna text-secondary text-2xl"></i>
            </div>
            <h3 class="text-xl font-bold mb-3">Genomic Data</h3>
            <p class="text-gray-600">Complete genome sequences are available for all strains, providing valuable resources for comparative genomic and functional studies.</p>
          </div>

          <div class="bg-neutral rounded-xl p-6 card-hover">
            <div class="w-14 h-14 bg-accent/10 rounded-lg flex items-center justify-center mb-6">
              <i class="fa fa-share-alt text-accent text-2xl"></i>
            </div>
            <h3 class="text-xl font-bold mb-3">Open Access</h3>
            <p class="text-gray-600">The biobank provides open access to researchers worldwide, facilitating gut microbiota research and therapeutic development.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- 数据规模 -->
    <section id="scale" class="py-20 bg-neutral">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-4">Database Scale</h2>
          <p class="text-gray-600 max-w-2xl mx-auto">Comprehensive collection of gut microbial strains with detailed taxonomic classification</p>
        </div>

        <div class="grid md:grid-cols-2 gap-10">
          <!-- 图表展示 -->
          <div class="bg-white rounded-xl p-6 shadow-md">
            <h3 class="text-xl font-bold mb-6">Taxonomic Distribution</h3>
            <div class="h-80">
              <canvas id="taxonomyChart"></canvas>
            </div>
          </div>

          <!-- 数据卡片 -->
          <div class="grid grid-cols-2 gap-6">
            <div class="bg-white rounded-xl p-6 shadow-md card-hover">
              <div class="text-primary text-3xl mb-2">
                <i class="fa fa-vial"></i>
              </div>
              <h4 class="text-lg font-semibold mb-1">Total Isolates</h4>
              <p class="text-3xl font-bold">1,170</p>
              <p class="text-gray-500 text-sm mt-2">From healthy volunteers</p>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-md card-hover">
              <div class="text-secondary text-3xl mb-2">
                <i class="fa fa-sitemap"></i>
              </div>
              <h4 class="text-lg font-semibold mb-1">Species</h4>
              <p class="text-3xl font-bold">400</p>
              <p class="text-gray-500 text-sm mt-2">Including 102 new species</p>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-md card-hover">
              <div class="text-accent text-3xl mb-2">
                <i class="fa fa-cubes"></i>
              </div>
              <h4 class="text-lg font-semibold mb-1">Genera</h4>
              <p class="text-3xl font-bold">159</p>
              <p class="text-gray-500 text-sm mt-2">28 novel genera identified</p>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-md card-hover">
              <div class="text-primary text-3xl mb-2">
                <i class="fa fa-cube"></i>
              </div>
              <h4 class="text-lg font-semibold mb-1">Phyla</h4>
              <p class="text-3xl font-bold">6</p>
              <p class="text-gray-500 text-sm mt-2">3 novel families described</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 功能特点 -->
    <section id="features" class="py-20 bg-white">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-4">Features</h2>
          <p class="text-gray-600 max-w-2xl mx-auto">Different access levels provide varied functionality based on user permissions</p>
        </div>

        <div class="grid md:grid-cols-2 gap-10">
          <!-- 游客权限 -->
          <div class="border border-gray-200 rounded-xl overflow-hidden shadow-md">
            <div class="bg-primary/10 p-6">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center">
                  <i class="fa fa-user text-primary"></i>
                </div>
                <h3 class="text-xl font-bold">Public Access</h3>
              </div>
            </div>
            <div class="p-6">
              <h4 class="font-semibold text-lg mb-4">Available Features:</h4>
              <ul class="space-y-3">
                <li class="flex items-start space-x-3">
                  <i class="fa fa-check text-green-500 mt-1"></i>
                  <span>Basic strain information查询</span>
                </li>
                <li class="flex items-start space-x-3">
                  <i class="fa fa-check text-green-500 mt-1"></i>
                  <span>Taxonomic classification浏览</span>
                </li>
                <li class="flex items-start space-x-3">
                  <i class="fa fa-check text-green-500 mt-1"></i>
                  <span>Public genomic data access</span>
                </li>
                <li class="flex items-start space-x-3">
                  <i class="fa fa-check text-green-500 mt-1"></i>
                  <span>Species description viewing</span>
                </li>
                <li class="flex items-start space-x-3">
                  <i class="fa fa-times text-red-500 mt-1"></i>
                  <span class="text-gray-500">Download detailed datasets</span>
                </li>
                <li class="flex items-start space-x-3">
                  <i class="fa fa-times text-red-500 mt-1"></i>
                  <span class="text-gray-500">Request strain samples</span>
                </li>
              </ul>
            </div>
          </div>

          <!-- 内部人员权限 -->
          <div class="border border-gray-200 rounded-xl overflow-hidden shadow-md">
            <div class="bg-accent/10 p-6">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-full bg-accent/20 flex items-center justify-center">
                  <i class="fa fa-user-secret text-accent"></i>
                </div>
                <h3 class="text-xl font-bold">Researcher Access</h3>
              </div>
            </div>
            <div class="p-6">
              <h4 class="font-semibold text-lg mb-4">Full Features Include:</h4>
              <ul class="space-y-3">
                <li class="flex items-start space-x-3">
                  <i class="fa fa-check text-green-500 mt-1"></i>
                  <span>Complete strain information</span>
                </li>
                <li class="flex items-start space-x-3">
                  <i class="fa fa-check text-green-500 mt-1"></i>
                  <span>Download genomic datasets</span>
                </li>
                <li class="flex items-start space-x-3">
                  <i class="fa fa-check text-green-500 mt-1"></i>
                  <span>Advanced search and analysis</span>
                </li>
                <li class="flex items-start space-x-3">
                  <i class="fa fa-check text-green-500 mt-1"></i>
                  <span>Strain sample request system</span>
                </li>
                <li class="flex items-start space-x-3">
                  <i class="fa fa-check text-green-500 mt-1"></i>
                  <span>Submit new strain data</span>
                </li>
                <li class="flex items-start space-x-3">
                  <i class="fa fa-check text-green-500 mt-1"></i>
                  <span>API access for programmatic queries</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 数据查询 -->
    <section id="query" class="py-20 bg-gradient-to-br from-primary/5 to-secondary/10">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-4">Database Search</h2>
          <p class="text-gray-600 max-w-2xl mx-auto">Search the human Gut Microbial Biobank using the following criteria</p>
        </div>

        <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-8">
          <!-- Excel文件上传区域 - 移动到查询表单上方 -->
          <div class="mb-8 pb-6 border-b border-gray-100">
            <h4 class="font-semibold mb-4">Upload Excel File</h4>
            <p class="text-gray-600 text-sm mb-4">Upload an Excel file to batch query or import data (requires login)</p>

            <div id="uploadArea" class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary transition-colors cursor-pointer">
              <input type="file" id="excelFile" accept=".xlsx,.xls" class="hidden">
              <div class="flex flex-col items-center justify-center">
                <i class="fa fa-file-excel-o text-4xl text-green-500 mb-3"></i>
                <p class="text-gray-700 font-medium">Click to select Excel file or drag and drop here</p>
                <p class="text-gray-500 text-sm mt-1">Supports .xlsx and .xls files</p>
              </div>
            </div>

            <div class="mt-4 flex justify-center">
              <button id="uploadBtn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors font-medium flex items-center">
                <i class="fa fa-upload mr-2"></i>Upload File
              </button>
            </div>

            <div id="uploadStatus" class="mt-4 text-center hidden"></div>
          </div>

          <!-- 查询表单 -->
          <form method="get">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <div>
                <label class="block text-gray-700 font-medium mb-2">Phylum / Order / Class / Family / Species / Strain</label>
                <input type="text" name="taxonomic_unit" placeholder="Enter taxonomic information" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
              </div>
            </div>

            <div class="flex flex-col sm:flex-row gap-4 justify-center">
              <button type="submit" class="bg-primary hover:bg-primary/90 text-white px-8 py-3 rounded-lg transition-colors font-medium flex items-center justify-center">
                <i class="fa fa-search mr-2"></i>Search Database
              </button>
              <button type="reset" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-8 py-3 rounded-lg transition-colors font-medium flex items-center justify-center">
                <i class="fa fa-refresh mr-2"></i>Reset
              </button>
            </div>
          </form>

          <div class="mt-8 pt-6 border-t border-gray-100">
            <h4 class="font-semibold mb-4">Search Tips</h4>
            <ul class="text-gray-600 text-sm space-y-2">
              <li class="flex items-start space-x-2">
                <i class="fa fa-info-circle text-primary mt-1"></i>
                <span>Use partial names or numbers for broader search results</span>
              </li>
              <li class="flex items-start space-x-2">
                <i class="fa fa-info-circle text-primary mt-1"></i>
                <span>Leave fields blank to search all entries in that category</span>
              </li>
              <li class="flex items-start space-x-2">
                <i class="fa fa-info-circle text-primary mt-1"></i>
                <span>Login to access advanced search filters and download options</span>
              </li>
            </ul>
          </div>
        </div>

        <!-- 查询结果展示区域 -->
        <div class="mt-8 pt-6 border-t border-gray-100">
          <!-- 结果将通过JS动态插入 -->
        </div>
      </div>
    </section>
  </main>

  <!-- 页脚 -->
  <footer class="bg-dark text-white py-12">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid md:grid-cols-2 gap-8">
        <div>
          <div class="flex items-center space-x-2 mb-6">
            <div class="w-10 h-10 rounded-lg bg-white flex items-center justify-center">
              <i class="fa fa-flask text-primary text-xl"></i>
            </div>
            <span class="text-xl font-bold">hGMB Database</span>
          </div>
          <p class="text-gray-400 mb-6">A comprehensive resource for human gut microbial strains, providing detailed taxonomic, genomic and biological information for the research community.</p>
          <div class="flex space-x-4">
            <a href="#" class="text-gray-400 hover:text-white transition-colors">
              <i class="fa fa-twitter"></i>
            </a>
            <a href="#" class="text-gray-400 hover:text-white transition-colors">
              <i class="fa fa-github"></i>
            </a>
            <a href="#" class="text-gray-400 hover:text-white transition-colors">
              <i class="fa fa-linkedin"></i>
            </a>
          </div>
        </div>

        <div>
          <h4 class="text-lg font-semibold mb-6">Contact Us</h4>
          <ul class="space-y-3">
            <li class="flex items-start space-x-3">
              <i class="fa fa-envelope text-gray-400 mt-1"></i>
              <span class="text-gray-400">hgmbiobank@example.com</span>
            </li>
            <li class="flex items-start space-x-3">
              <i class="fa fa-phone text-gray-400 mt-1"></i>
              <span class="text-gray-400">+86 123 4567 8910</span>
            </li>
            <li class="flex items-start space-x-3">
              <i class="fa fa-map-marker text-gray-400 mt-1"></i>
              <span class="text-gray-400">China General Microbiological Culture Collection Center<br>Beijing, China</span>
            </li>
          </ul>
        </div>
      </div>

      <div class="border-t border-gray-800 mt-10 pt-6 flex flex-col md:flex-row justify-between items-center">
        <p class="text-gray-500 text-sm">© 2023 hGMB Database. All rights reserved.</p>
        <div class="flex space-x-6 mt-4 md:mt-0">
          <a href="#" class="text-gray-500 hover:text-gray-300 text-sm">Privacy Policy</a>
          <a href="#" class="text-gray-500 hover:text-gray-300 text-sm">Terms of Use</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- 登录模态框 -->
  <div id="loginModal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center backdrop-blur-sm">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 transform transition-all scale-95 opacity-0" id="modalContent">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold">User Login</h3>
        <button id="closeModal" class="text-gray-500 hover:text-gray-700">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>

      <form id="loginForm">
        <div class="mb-4">
          <label for="username" class="block text-gray-700 font-medium mb-2">Username</label>
          <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" placeholder="Enter your username">
        </div>

        <div class="mb-6">
          <label for="password" class="block text-gray-700 font-medium mb-2">Password</label>
          <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" placeholder="Enter your password">
        </div>

        <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white py-3 rounded-lg transition-colors font-medium">Login</button>
      </form>

      <div class="mt-6 text-center">
        <p class="text-gray-600">Need an account? <a href="#" class="text-primary hover:text-primary/80 font-medium">Contact administrator</a></p>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    // 页面加载时检查登录状态
    document.addEventListener('DOMContentLoaded', function() {
      checkLoginStatus();
      // 清除可能的残留错误状态
      window.addEventListener('unhandledrejection', function(event) {
        console.error('未处理的Promise错误:', event.reason);
        event.preventDefault(); // 阻止浏览器默认错误提示
      });
    });

    // 导航栏滚动效果
    window.addEventListener('scroll', function() {
      const navbar = document.getElementById('navbar');
      if (window.scrollY > 50) {
        navbar.classList.add('nav-scrolled');
      } else {
        navbar.classList.remove('nav-scrolled');
      }
    });

    // 移动端菜单切换
    const menuBtn = document.getElementById('menuBtn');
    const mobileMenu = document.getElementById('mobileMenu');

    menuBtn.addEventListener('click', function() {
      mobileMenu.classList.toggle('hidden');
      if (mobileMenu.classList.contains('hidden')) {
        menuBtn.innerHTML = '<i class="fa fa-bars text-2xl"></i>';
      } else {
        menuBtn.innerHTML = '<i class="fa fa-times text-2xl"></i>';
      }
    });

    // 登录模态框控制
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const loginModal = document.getElementById('loginModal');
    const modalContent = document.getElementById('modalContent');
    const closeModal = document.getElementById('closeModal');

    loginBtn.addEventListener('click', function() {
      loginModal.classList.remove('hidden');
      loginModal.classList.add('flex');
      setTimeout(() => {
        modalContent.classList.remove('scale-95', 'opacity-0');
        modalContent.classList.add('scale-100', 'opacity-100', 'transition-all', 'duration-300');
      }, 10);
    });

    function closeLoginModal() {
      modalContent.classList.remove('scale-100', 'opacity-100');
      modalContent.classList.add('scale-95', 'opacity-0', 'transition-all', 'duration-300');
      setTimeout(() => {
        loginModal.classList.add('hidden');
        loginModal.classList.remove('flex');
      }, 300);
    }

    closeModal.addEventListener('click', closeLoginModal);
    loginModal.addEventListener('click', function(e) {
      if (e.target === loginModal) {
        closeLoginModal();
      }
    });

    // 分类学分布图表
    const taxonomyCtx = document.getElementById('taxonomyChart').getContext('2d');
    new Chart(taxonomyCtx, {
      type: 'bar',
      data: {
        labels: ['Firmicutes', 'Bacteroidetes', 'Actinobacteria', 'Proteobacteria', 'Fusobacteria', 'Verrucomicrobia'],
        datasets: [{
          label: 'Number of Species',
          data: [215, 103, 42, 25, 12, 3],
          backgroundColor: '#165DFF',
          borderRadius: 6
        }, {
          label: 'New Species Discovered',
          data: [58, 22, 12, 6, 3, 1],
          backgroundColor: '#0FC6C2',
          borderRadius: 6
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top'
          },
          title: {
            display: true,
            text: 'Species Distribution by Phylum'
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Number of Species'
            }
          },
          x: {
            title: {
              display: true,
              text: 'Phylum'
            }
          }
        }
      }
    });

    // 平滑滚动到锚点
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();

        const targetId = this.getAttribute('href');
        if (targetId === '#') return;

        const targetElement = document.querySelector(targetId);
        if (targetElement) {
          if (!mobileMenu.classList.contains('hidden')) {
            mobileMenu.classList.add('hidden');
            menuBtn.innerHTML = '<i class="fa fa-bars text-2xl"></i>';
          }

          window.scrollTo({
            top: targetElement.offsetTop - 80,
            behavior: 'smooth'
          });
        }
      });
    });

    // 检查登录状态
    function checkLoginStatus() {
      const token = localStorage.getItem('access_token');
      if (token) {
        loginBtn.classList.add('hidden');
        logoutBtn.classList.remove('hidden');
      } else {
        loginBtn.classList.remove('hidden');
        logoutBtn.classList.add('hidden');
      }
    }

    // 登出功能
    logoutBtn.addEventListener('click', function() {
      localStorage.removeItem('access_token');
      localStorage.removeItem('refresh_token');
      checkLoginStatus();
      alert('已成功登出');
    });

    // 登录功能（适配TokenObtainPairView）
    document.getElementById("loginForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      if (!username || !password) {
        alert("请输入用户名和密码");
        return;
      }

      fetch("/api/token/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-Requested-With": "XMLHttpRequest"
        },
        body: JSON.stringify({ username, password })
      })
      .then(response => {
        if (!response.ok) {
          return response.json().then(err => {
            throw new Error(err.detail || "登录失败，用户名或密码错误");
          });
        }
        return response.json();
      })
      .then(data => {
        localStorage.setItem("access_token", data.access);
        localStorage.setItem("refresh_token", data.refresh);
        closeLoginModal();
        checkLoginStatus();
        document.getElementById("loginForm").reset();
        alert("登录成功！");
      })
      .catch(error => {
        console.error("登录错误:", error);
        alert(error.message || "登录失败，请检查用户名和密码");
      });
    });

    // Excel文件上传功能
    let selectedFile = null;

    // 文件选择处理
    document.getElementById('uploadArea').addEventListener('click', function() {
      document.getElementById('excelFile').click();
    });

    // 拖放功能
    document.getElementById('uploadArea').addEventListener('dragover', function(e) {
      e.preventDefault();
      this.classList.add('border-primary', 'bg-primary/5');
    });

    document.getElementById('uploadArea').addEventListener('dragleave', function(e) {
      e.preventDefault();
      this.classList.remove('border-primary', 'bg-primary/5');
    });

    document.getElementById('uploadArea').addEventListener('drop', function(e) {
      e.preventDefault();
      this.classList.remove('border-primary', 'bg-primary/5');

      const files = e.dataTransfer.files;
      if (files.length > 0) {
        handleFileSelection(files[0]);
      }
    });

    // 文件选择处理
    document.getElementById('excelFile').addEventListener('change', function(e) {
      if (e.target.files.length > 0) {
        handleFileSelection(e.target.files[0]);
      }
    });

    function handleFileSelection(file) {
      // 检查文件类型
      const allowedTypes = [
        'application/vnd.ms-excel',
        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
        'application/octet-stream'
      ];

      const fileExtension = file.name.split('.').pop().toLowerCase();

      if (!allowedTypes.includes(file.type) && !['xls', 'xlsx'].includes(fileExtension)) {
        alert('请选择有效的Excel文件 (.xls 或 .xlsx)');
        return;
      }

      selectedFile = file;

      // 更新UI显示
      const uploadArea = document.getElementById('uploadArea');
      uploadArea.innerHTML = `
        <div class="flex flex-col items-center justify-center">
          <i class="fa fa-check-circle text-4xl text-green-500 mb-3"></i>
          <p class="text-gray-700 font-medium">已选择文件</p>
          <p class="text-gray-500 text-sm mt-1">${file.name}</p>
          <p class="text-gray-400 text-xs mt-2">${(file.size / 1024 / 1024).toFixed(2)} MB</p>
        </div>
      `;
    }

    // 上传文件函数
    async function uploadExcelFile(token, file) {
      const formData = new FormData();
      formData.append('file', file);

      try {
        const response = await fetch('bacteria/upload/', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`
          },
          body: formData
        });

        if (!response.ok) {
          const errorData = await response.json().catch(() => null);
          throw new Error(errorData?.detail || `上传失败: ${response.status}`);
        }

        return await response.json();
      } catch (error) {
        console.error('上传错误:', error);
        throw error;
      }
    }

    // 上传按钮点击事件
    document.getElementById('uploadBtn').addEventListener('click', async function() {
      const token = localStorage.getItem('access_token');

      if (!token) {
        alert('请先登录以上传文件');
        loginBtn.click();
        return;
      }

      if (!selectedFile) {
        alert('请先选择Excel文件');
        return;
      }

      const uploadBtn = this;
      const originalText = uploadBtn.innerHTML;
      uploadBtn.disabled = true;
      uploadBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>上传中...';

      const statusDiv = document.getElementById('uploadStatus');
      statusDiv.classList.remove('hidden', 'text-red-500', 'text-green-500');
      statusDiv.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>文件上传中，请稍候...';
      statusDiv.classList.add('text-blue-500');

      try {
        const result = await uploadExcelFile(token, selectedFile);

        statusDiv.innerHTML = '<i class="fa fa-check-circle mr-2"></i>文件上传成功！';
        statusDiv.classList.remove('text-blue-500');
        statusDiv.classList.add('text-green-500');

        console.log('上传结果:', result);
        // 可以在这里处理上传成功后的逻辑，比如显示结果或刷新页面

      } catch (error) {
        console.error('上传失败:', error);
        statusDiv.innerHTML = `<i class="fa fa-exclamation-circle mr-2"></i>${error.message}`;
        statusDiv.classList.remove('text-blue-500');
        statusDiv.classList.add('text-red-500');
      } finally {
        uploadBtn.disabled = false;
        uploadBtn.innerHTML = originalText;
      }
    });

    document.querySelector("form").addEventListener("submit", function(e) {
        e.preventDefault();

        const taxonomicUnit = document.querySelector('input[name="taxonomic_unit"]').value.trim();
        const resultsContainer = document.querySelector('.mt-8.pt-6.border-t.border-gray-100');

        if (!taxonomicUnit) {
            alert("请输入分类单元！");
            return;
        }

        // 重置结果区域
        resultsContainer.innerHTML = '<p class="text-gray-600">查询中...</p>';

        // 构建请求头
        const headers = {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        };

        // 添加Token（如果存在）
        const token = localStorage.getItem('access_token');
        if (token) {
            headers['Authorization'] = `Bearer ${token}`;
            console.log("使用Token查询:", token.substring(0, 20) + "...");
        } else {
            console.log("未登录，使用匿名查询");
        }

        // 编码查询参数
        const encodedUnit = encodeURIComponent(taxonomicUnit);
        const url = `/bacteria/search/?taxonomic_unit=${encodedUnit}`;
        console.log("查询URL:", url);

        // 发送查询请求
        fetch(url, {
            method: 'GET',
            headers: headers,
            credentials: 'include'
        })
        .then(response => response.json())
        .then(data => {
            console.log("查询结果:", data);

            if (data.results && data.results.length > 0) {
                let resultHTML = '<h4 class="font-semibold mb-3 text-base">查询结果</h4><table class="min-w-full bg-white border border-gray-200 rounded-lg shadow-md text-sm">';
                resultHTML += '<thead><tr>';

                // 根据角色动态生成表头
                const columns = data.results[0];
                Object.keys(columns).forEach(field => {
                    resultHTML += `<th class="py-2.5 px-3.5 text-left font-semibold text-gray-600">${field}</th>`;
                });
                resultHTML += '</tr></thead><tbody>';

                // 遍历查询结果生成表格
                data.results.forEach(item => {
                    resultHTML += '<tr>';
                    Object.values(item).forEach(value => {
                        resultHTML += `<td class="py-2.5 px-3.5">${value || '-'}</td>`;
                    });
                    resultHTML += '</tr>';
                });

                resultHTML += '</tbody></table>';
                resultsContainer.innerHTML = resultHTML;
            } else {
                resultsContainer.innerHTML = '<p class="text-gray-500">没有查询到匹配的结果。</p>';
            }
        })
        .catch(error => {
            console.error('查询错误详情:', error);
            resultsContainer.innerHTML = `<p class="text-red-500">${error.message}</p>`;
        });
    });
  </script>
</body>
</html>